(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{322:function(t,s,a){"use strict";a.r(s);var n=a(40),r=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"deployment-部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deployment-部署","aria-hidden":"true"}},[t._v("#")]),t._v(" Deployment/部署")]),t._v(" "),a("h2",{attrs:{id:"阿里云-腾讯云-digital-ocean"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阿里云-腾讯云-digital-ocean","aria-hidden":"true"}},[t._v("#")]),t._v(" 阿里云/腾讯云/Digital Ocean")]),t._v(" "),a("h4",{attrs:{id:"云服务器-centos"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#云服务器-centos","aria-hidden":"true"}},[t._v("#")]),t._v(" 云服务器(centos)")]),t._v(" "),a("p",[t._v("首先需要安装一些基础的软件包，请自行安装（具体参照其官网文档）")]),t._v(" "),a("ul",[a("li",[t._v("node")]),t._v(" "),a("li",[t._v("npm")]),t._v(" "),a("li",[t._v("nginx")]),t._v(" "),a("li",[t._v("yarn")]),t._v(" "),a("li",[t._v("pm2")])]),t._v(" "),a("p",[t._v("以下脚本仅供参考")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# install yarn")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" --silent --location https://dl.yarnpkg.com/rpm/yarn.repo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" /etc/yum.repos.d/yarn.repo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" -y\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# install nginx")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" nginx -y\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# install pm2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" pm2 -g\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pm2 examples")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pm2 start server.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pm2 stop server")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pm2 restart server")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pm2 stop all")]),t._v("\n\n")])])]),a("p",[t._v("nginx 配置文件 demo")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" your_domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_body_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("M"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_max_body_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("M"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("M"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("M"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_busy_buffers_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("M"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl")]),t._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate")]),t._v(" cert"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("luban"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate_key")]),t._v(" cert"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("luban"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_session_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_ciphers")]),t._v(" ECDHE"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("RSA"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("AES128"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("GCM"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("SHA256"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ECDHE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ECDH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("AES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("HIGH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("NULL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("aNULL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("MD5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("ADH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("RC4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_protocols")]),t._v(" TLSv1 TLSv1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" TLSv1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_prefer_server_ciphers")]),t._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip")]),t._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_min_length")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_buffers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_disable")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MSIE [1-6]\\."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_comp_level")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_types")]),t._v(" image"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("png application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("json text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("plain application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("javascript text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("css application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("xml text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("javascript application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("javascript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# TODO 这边的 psd-files、engine-assets、third-libs 开发的时候，可以走 proxy_pass")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生产环境的时候，最好走另外的 location，直接让 nginx 访问静态文件")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("upload"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("manager"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("users"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("permissions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("works"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("admin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("psd"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("files"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("workforms"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("third"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("libs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("engine"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("assets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Real"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Forwarded"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("centos"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("codebase"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("luban"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("luban"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("h5"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dist"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("front"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("end"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#try_files $uri $uri/ /index.html;")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"本地执行："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本地执行：","aria-hidden":"true"}},[t._v("#")]),t._v(" 本地执行：")]),t._v(" "),a("p",[t._v("请先提前调研：flightplan\n在项目根目录作如下操作：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" flightplan // 部署脚本，官方链接\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run deploy:esc // 云服务器 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Elastic Compute Service, 简称 ECS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("本地部署脚本")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" os "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'os'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" plan "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'flightplan'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// configuration")]),t._v("\nlocal_dist_dir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// root path for luban-h5")]),t._v("\nremote_project_dir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'~/codebase/luban/luban-h5'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// root path for luban-h5 on server")]),t._v("\nremote_project_api_dir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'~/codebase/luban/luban-h5/back-end/h5-api'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// api root path for luban-h5 on server")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// production server config")]),t._v("\nplan"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'your host ip'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// your server ip")]),t._v("\n  username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'centos'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// your server username")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 更新为绝对路径")]),t._v("\n  privateKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("homedir"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("/.ssh/id_rsa")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// your privateKey to rsync files")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 1. setup folders\n * 2. sync files\n * 3. install dependencies\n * 4. (re)start api service\n * 5. soft link nginx conf\n *\n * 1. 创建同步文件件\n * 2. 同步本地在 git 中的文件（你也可以在服务器端git clone）\n * 3. 在 h5-api 目录安装依赖\n * 4. 使用pm2 重启服务\n * 5. 给 nginx 文件做一个软件链接\n *\n */")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// init remove server path")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在第一步的时候，需要打开这一项：初始化服务器，现在还不完整，需要补充")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// plan.remote(remote => {")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   // remove.exec(`mkdir -p ${remote_project_dir}`)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   remove.sudo(`yum install nginx -y`)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   remote.with(`mkdir -p ${remote_project_dir}`, () => {")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     // remote.log('Install dependencies');")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     // remote.exec('yarn');")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     remote.exec('pwd');")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   });")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// });")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// run commands on localhost")]),t._v("\nplan"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("local")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("local")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// local.log('=> Run build');")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// local.exec('npm run build');")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// local.log('=> Build finish');")]),t._v("\n\n  local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'=> Copy files to remote hosts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// TODO reference: https://github.com/pstadler/flightplan/issues/142")]),t._v("\n  local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("cd ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("local_dist_dir"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// const filesToCopy = local.exec('find . -type f', { silent: true })")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" filesToCopy "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ls-files'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("silent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// get list of files under version control")]),t._v("\n\n    local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("transfer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filesToCopy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" remote_project_dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'=> Copy finish'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// run commands on the target's remote hosts")]),t._v("\nplan"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("remote")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("remote")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  remote"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("cd ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("remote_project_api_dir"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    remote"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Install dependencies'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    remote"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'yarn'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    remote"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pm2 restart server'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n")])])]),a("h4",{attrs:{id:"中间可能遇到的一些问题："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#中间可能遇到的一些问题：","aria-hidden":"true"}},[t._v("#")]),t._v(" 中间可能遇到的一些问题：")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("Cannot parse privateKey: Unsupported key format")]),t._v(" \n解决方案请参照："),a("a",{attrs:{href:"https://stackoverflow.com/questions/53400628/cannot-parse-privatekey-unsupported-key-format",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cannot parse privateKey: Unsupported key format"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"docker-部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-部署","aria-hidden":"true"}},[t._v("#")]),t._v(" Docker 部署")]),t._v(" "),a("blockquote",[a("p",[t._v("以下方案来自："),a("a",{attrs:{href:"https://github.com/yi-ge/luban-h5#docker-%E9%83%A8%E7%BD%B2",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/yi-ge/luban-h5#docker-%E9%83%A8%E7%BD%B2"),a("OutboundLink")],1),t._v("，非常非常感谢。\n但仅供参考，此方案不是鲁班的官方的解决方案")]),t._v(" "),a("p",[t._v("鲁班决定暂时不按照这种方案来做，可以先使用上面部署脚本来发布到服务器上，进行部署。\n鲁班后期考虑出一个简单版本docker image的部署方案，直接拉镜像，在服务器端就能直接跑起来。")])]),t._v(" "),a("p",[t._v("请确保您的"),a("code",[t._v("80")]),t._v("端口和"),a("code",[t._v("443")]),t._v("端口均打开，如果已经配置了其它项目，请进行手工调整。")]),t._v(" "),a("ol",[a("li",[t._v("修改"),a("code",[t._v("yourdomain.tld")]),t._v("为您的前端域名并解析到服务器。")]),t._v(" "),a("li",[t._v("修改"),a("code",[t._v("api.yourdomain.tld")]),t._v("为您的后端域名并解析到服务器。")]),t._v(" "),a("li",[t._v("依次执行以下命令。")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Clone luban-h5")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/ly525/luban-h5.git\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" luban-h5\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Install require package")]),t._v("\ndocker run --rm -v "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("pwd")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(":/root -w /root/back-end/h5-api node:12.8.1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yarn && NODE_ENV=production yarn build"')]),t._v("\n\ndocker run --rm -v "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("pwd")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(":/root -w /root/front-end/h5 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --env "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PUBLIC_PATH=/"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --env "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROD_API_ORIGIN=api.yourdomain.tld"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    node:12.8.1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yarn && NODE_ENV=production yarn build && node build/engine.webpack.js"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Start back-end")]),t._v("\ndocker run --detach "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --name nginx-proxy "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --publish "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(":80 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --publish "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(":443 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --volume /etc/nginx/certs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --volume /etc/nginx/vhost.d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --volume /usr/share/nginx/html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --volume /var/run/docker.sock:/tmp/docker.sock:ro "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    jwilder/nginx-proxy\n\ndocker run --detach "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --name nginx-proxy-letsencrypt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --volumes-from nginx-proxy "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --volume /var/run/docker.sock:/var/run/docker.sock:ro "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    jrcs/letsencrypt-nginx-proxy-companion\n\ndocker run -itd -m 512m "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("always "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --name luban-h5-front "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    -v "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("pwd")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("/front-end/h5/dist:/usr/share/nginx/html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --env "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NODE_ENV=production"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --env "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"VIRTUAL_HOST=yourdomain.tld"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --env "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LETSENCRYPT_HOST=yourdomain.tld"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --env "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROD_API_ORIGIN=api.yourdomain.tld"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Start font-end")]),t._v("\ndocker run -itd -m 1024m "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --name luban-h5-api "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("always "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    -v "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("pwd")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(":/root -w /root/back-end/h5-api "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),t._v(":1337 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --env "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NODE_ENV=production"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --env "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"VIRTUAL_PORT=1337"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --env "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"VIRTUAL_HOST=api.yourdomain.tld"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --env "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LETSENCRYPT_HOST=api.yourdomain.tld"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n   --restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("always node:12.8.1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" start\n")])])]),a("p",[t._v("稍等片刻，访问"),a("code",[t._v("https://你的域名")]),t._v("，部署完成。")]),t._v(" "),a("p",[t._v("关于Nginx、SSL的配置，可以参考："),a("a",{attrs:{href:"https://github.com/JrCs/docker-letsencrypt-nginx-proxy-companion",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/JrCs/docker-letsencrypt-nginx-proxy-companion"),a("OutboundLink")],1)]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("docker 自我学习，请忽略")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("docker --rm\n\t相当于：\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(". docker run hello-world"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hello-world为image-name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(". docker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" hello-world-container-id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("通过 docker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" -a 查看"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t在Docker容器退出时，默认容器内部的文件系统仍然被保留，以方便调试并保留用户数据。\n\t但是，对于foreground容器，由于其只是在开发调试过程中短期运行，其用户数据并无保留的必要，因而可以在容器启动时设置--rm选项，这样在容器退出时就能够自动清理容器内部的文件系统。示例如下：\n\tdocker run --rm bba-208等价于docker run --rm"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true bba-208。\n\t显然，--rm选项不能与-d同时使用，即只能自动清理foreground容器，不能自动清理detached容器\n\t注意，--rm选项也会清理容器的匿名data volumes。\n\t所以，执行docker run命令带--rm命令选项，等价于在容器退出后，执行docker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -v。\n\n\nDocker命令详解（run篇）\n\t命令格式：docker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" IMAGE "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("COMMAND"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ARG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\tUsage: Run a "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" a new container\n\t中文意思为：通过run命令创建一个新的容器（container）\n\n\t常用选项说明\n\t-d, --detach"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false， 指定容器运行于前台还是后台，默认为false\n\t-i, --interactive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false， 打开STDIN，用于控制台交互\n\t-t, --tty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false， 分配tty设备，该可以支持终端登录，默认为false\n\t-u, --user"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("， 指定容器的用户\n\t-a, --attach"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("， 登录容器（必须是以docker run -d启动的容器）\n\t-w, --workdir"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("， 指定容器的工作目录\n\t-c, --cpu-shares"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("， 设置容器CPU权重，在CPU共享场景使用\n\t-e, --env"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("， 指定环境变量，容器中可以使用该环境变量\n\t-m, --memory"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("， 指定容器的内存上限\n\t-P, --publish-all"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false， 指定容器暴露的端口\n\t-p, --publish"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("， 指定容器暴露的端口\n\t-h, --hostname"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("， 指定容器的主机名\n\t-v, --volume"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("， 给容器挂载存储卷，挂载到容器的某个目录\n\t--volumes-from"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("， 给容器挂载其他容器上的卷，挂载到容器的某个目录\n\t--cap-add"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("， 添加权限，权限清单详见：http://linux.die.net/man/7/capabilities\n\t--cap-drop"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("， 删除权限，权限清单详见：http://linux.die.net/man/7/capabilities\n\t--cidfile"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("， 运行容器后，在指定文件中写入容器PID值，一种典型的监控系统用法\n\t--cpuset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("， 设置容器可以使用哪些CPU，此参数可以用来容器独占CPU\n\t--device"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("， 添加主机设备给容器，相当于设备直通\n\t--dns"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("， 指定容器的dns服务器\n\t--dns-search"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("， 指定容器的dns搜索域名，写入到容器的/etc/resolv.conf文件\n\t--entrypoint"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("， 覆盖image的入口点\n\t--env-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("， 指定环境变量文件，文件格式为每行一个环境变量\n\t--expose"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("， 指定容器暴露的端口，即修改镜像的暴露端口\n\t--link"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("， 指定容器间的关联，使用其他容器的IP、env等信息\n\t--lxc-conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("， 指定容器的配置文件，只有在指定--exec-driver"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("lxc时使用\n\t--name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("， 指定容器名字，后续可以通过名字进行容器管理，links特性需要使用名字\n\t--net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bridge"')]),t._v("， 容器网络设置:\n\tbridge 使用docker daemon指定的网桥\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" //容器使用主机的网络\n\tcontainer:NAME_or_ID "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("//使用其他容器的网路，共享IP和PORT等网络资源\n\tnone 容器使用自己的网络（类似--net"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("bridge），但是不进行配置\n\t--privileged"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false， 指定容器是否为特权容器，特权容器拥有所有的capabilities\n\t--restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"no"')]),t._v("， 指定容器停止后的重启策略:\n\tno：容器退出时不重启\n\ton-failure：容器故障退出（返回值非零）时重启\n\talways：容器退出时总是重启\n\t--rm"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false， 指定容器停止后自动删除容器"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("不支持以docker run -d启动的容器"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t--sig-proxy"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true， 设置由代理接受并处理信号，但是SIGCHLD、SIGSTOP和SIGKILL不能被代理\n\t示例\n\t运行一个在后台执行的容器，同时，还能用控制台管理：docker run -i -t -d ubuntu:latest\n\t运行一个带命令在后台不断执行的容器，不直接展示容器内部信息：docker run -d ubuntu:latest "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" www.docker.com\n\t运行一个在后台不断执行的容器，同时带有命令，程序被终止后还能重启继续跑，还能用控制台管理，docker run -d --restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("always ubuntu:latest "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" www.docker.com\n\t为容器指定一个名字，docker run -d --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ubuntu_server ubuntu:latest\n\t容器暴露80端口，并指定宿主机80端口与其通信"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(": 之前是宿主机端口，之后是容器需暴露的端口"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("，docker run -d --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ubuntu_server -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(":80 ubuntu:latest\n\t指定容器内目录与宿主机目录共享"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(": 之前是宿主机文件夹，之后是容器需共享的文件夹"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("，docker run -d --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ubuntu_server -v /etc/www:/var/www ubuntu:latest\n")])])]),a("h2",{attrs:{id:"heroku"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#heroku","aria-hidden":"true"}},[t._v("#")]),t._v(" Heroku")]),t._v(" "),a("blockquote",[a("p",[t._v("因为 Strapi + postgresql  在 Heroku 上还有一些坑，需要官方解决，这个方案暂时pending")])]),t._v(" "),a("hr"),t._v(" "),a("Vssue",{attrs:{issueId:"7"}})],1)},[],!1,null,null,null);s.default=r.exports}}]);